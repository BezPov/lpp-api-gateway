language: generic
sudo: required
services: docker
branches:
  only:
  - master
env:
  global:
  - PROJECT_NAME=lpp-api-gateway
  - PROJECT_VERSION=1.0.1
  - DOCKER_USERNAME=bezpov
  - secure: CBi+UWBxYoqT68fUjpCOgv6f23nzrfC1imVjs/FGCxn2ke5wcEyQVddzLgPnVXA5mNPJqg3pzA3UO7fRXUF3vWLONyf7rzJqa3BbQVqvBYWeHO9LCTehs3FU19e3m0OesCo91Hok41elCHM2V/l7X6NXnuR4lFsFhNZeRa1L6pDMv2PIGe8sWat18LQPDTxaaVCIMSUYur1gFainW3ScfJnOR0oebnbUM6iisOQyLh5wT/vlgULu9JUh+Na0X2tcFu9TrP6zF2MPB9PFBNE9opAjhh3ex7cGLAEXlLL7IaT088moHGurVUk8uISbwJ6LCl835Y3LjZ2AU2zy9lUr/xZp8K7abiSpaGIAkmovg0QZDnpM4WCkL4s0XLL7+Oc3wn85tV+KlTfGvYdgy2ytDlSj2VJ9JsSFE4hFR/O7+Pbcy4sKFGCHHdSRMLrNYNo9ijCiKvHX2XfsVevLFl9Mtj2SaoTT7jnjgrB+y60htZ0uQCSkBVWZCyJhoFPC+OGov6ScO9ZwEudUsCrAmviTrpSbhS4jJQGEtA6Q1DG3eotHSn2KRRPVbvi9rsgg1GnOzxBwQSuKRxA4sIqFDaEBzjvGizclS/lFeJ5NY24VcxhLQE3ncK+twKDR4/XYk1mGzZSBREuCRD5U1/bulqxuXR9dt/sseFvHNxJ3dT5CMQg=
before_install:
- openssl aes-256-cbc -K $encrypted_1f877bfeae36_key -iv $encrypted_1f877bfeae36_iv
  -in .\kubernetes\google-travis-service-account.json.enc -out .\\kubernetes\\google-travis-service-account.json
  -d
- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
- docker image build -t $PROJECT_NAME:$PROJECT_VERSION .
- docker image tag $PROJECT_NAME:$PROJECT_VERSION $DOCKER_USERNAME/$PROJECT_NAME:$PROJECT_VERSION
- docker image push $DOCKER_USERNAME/$PROJECT_NAME
- gcloud version || true
- if [ ! -d "$HOME/google-cloud-sdk/bin" ]; then rm -rf $HOME/google-cloud-sdk; export
  CLOUDSDK_CORE_DISABLE_PROMPTS=1; curl https://sdk.cloud.google.com | bash; fi
- source /home/travis/google-cloud-sdk/path.bash.inc
- gcloud version
- gcloud auth activate-service-account --key-file ./kubernetes/google-travis-service-account.json
- gcloud config set project massive-boulder-263710
- gcloud container clusters get-credentials lpp --zone us-central1-a --project massive-boulder-263710
- gcloud components install kubectl
- kubectl apply -f ./kubernetes/deployment.yaml
